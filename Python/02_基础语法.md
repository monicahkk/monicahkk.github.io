## csv - 文件读写
### 函数说明
#### reader类
```python
csv.reader(csvfile, dialect='excel', **fmtparams)
```
- 返回一个 reader 对象，该对象将逐行遍历 csvfile
- csvfile 可以是任何对象，只要这个对象支持 [iterator](https://docs.python.org/zh-cn/3/glossary.html#term-iterator) 协议并在每次调用 __next__() 方法时都返回字符串，文件对象 和列表对象均适用
- 可选参数 dialect 是用于不同的 CSV 变种的特定参数组。
- 可选关键字参数 fmtparams 可以覆写当前变种格式中的单个格式设置
|| :-: || :-: ||
|| Reader对象 || 解释 ||
| __next__() | 返回 reader 的可迭代对象的下一行，它可以是一个列表（如果对象是由 reader() 返回）或字典（如果是一个 DictReader 实例），根据当前 Dialect 来解析。 通常你应当以 next(reader) 的形式来调用它。 |
| line_num | 迭代器已经读取了的行数。它与返回的记录数不同，因为记录可能跨越多行 |

|| :-: || :-: ||
|| DictReader对象 || 解释 ||
| fieldnames | 字段名称。如果在创建对象时未传入字段名称，则首次访问时或从文件中读取第一条记录时会初始化此属性。 |

```python
import csv
with open('some.csv', newline='') as f:
    reader = csv.reader(f)
    for row in reader:
        print(row)

# 非csv
import csv
with open('passwd', newline='') as f:
    reader = csv.reader(f, delimiter=':', quoting=csv.QUOTE_NONE)
    for row in reader:
        print(row)
```

#### writer类
- 对于 Writer 对象，行 必须是（一组可迭代的）字符串或数字。对于 DictWriter 对象，行 必须是一个字典，这个字典将字段名映射为字符串或数字（数字要先经过 str() 转换类型）

|| :-: || :-: ||
|| Writer对象 || 解释 ||
| writerow | 将 row 形参写入到 writer 的文件对象，根据当前 Dialect 进行格式化。 返回对下层文件对象的 write 方法的调用的返回值 |
| writerows | 将 `rows*`（即能迭代出多个上述 `*row` 对象的迭代器）中的所有元素写入 writer 的文件对象，并根据当前设置的变种进行格式化 |
| dialect | 变种描述，只读，供 writer 使用 |

|| :-: || :-: ||
|| DictWriter对象 || 解释 ||
| writeheader | 在 writer 的文件对象中，写入一行字段名称（字段名称在构造函数中指定），并根据当前设置的变种进行格式化 |

```python
import csv
with open('some.csv', 'w', newline='') as f:
    writer = csv.writer(f)
    writer.writerows(someiterable)
```

##### 变种格式
|| :-: || :-: ||
||  ||  ||
| delimiter | 分隔符，默认',' |
| doublequote | 控制出现在字段中的 `引号字符` 本身应如何被引出。
- 当该属性为 `True` 时，双写引号字符。
- 如果该属性为 `False`，则在 `引号字符` 的前面放置 `转义符`。
默认值为 `True`。
在输出时，如果 `doublequote` 是 `False`，且 `转义符` 未指定，且在字段中发现 `引号字符` 时，会抛出 `Error` 异常。 |
| escapechar | 一个用于 writer 的单字符，用来在 quoting 设置为 QUOTE_NONE 的情况下转义 定界符，在 doublequote 设置为 False 的情况下转义 引号字符。在读取时，escapechar 去除了其后所跟字符的任何特殊含义。该属性默认为 None，表示禁用转义 |
| lineterminator | 放在 writer 产生的行的结尾，默认为 '\r\n'。 |
| quotechar | 一个单字符，用于包住含有特殊字符的字段，特殊字符如 定界符 或 引号字符 或换行符。默认为 '"' |
| quoting | 控制 writer 何时生成引号，以及 reader 何时识别引号。 |
| skipinitialspace | 如果为 True，则忽略 定界符 之后的空格 |
| strict | 如果为 True，则在输入错误的 CSV 时抛出 Error 异常 |

#### 示例
##### 修改编码
```python
import csv
with open('some.csv', newline='', encoding='utf-8') as f:
    reader = csv.reader(f)
    for row in reader:
        print(row)
```

##### 注册一个新的变种
```python
import csv
csv.register_dialect('unixpwd', delimiter=':', quoting=csv.QUOTE_NONE)
with open('passwd', newline='') as f:
    reader = csv.reader(f, 'unixpwd')
```

#### 获取每一行
```python
import csv

with open('data.csv','r') as f:
    reader = csv.reader(f) 
    print(type(reader)) # 返回_csv.reader对象

    for row in reader: # 输出
        print(row)

# 不需要单写close
indata = open(from_file).read()
```
#### 获取某一行
```python
with open('data.csv','r') as f:
    reader = csv.reader(f)
    datalist = list(reader) 
    print(datalist[1])
```
#### 获取某一列
```python
with open('data.csv','r') as f:
    reader = csv.reader(f)
    for i in reader:
        print(i[0])
```

### 获取某一列
```python
with open('data.csv','r') as f:
    reader = csv.reader(f)
    for i in reader:
        print(i[0])
```

### 读/写的文件模式

|| :-: || :-: ||
|'r' | open for reading (default) |
| 'w' | open for writing, truncating the file first |
| 'x' | create a new file and open it for writing |
| 'a' | open for writing, appending to the end of the file if it exists |
| 'b' | binary mode |
| 't' | text mode (default) |
| '+' | open a disk file for updating (reading and writing) |
| 'U' | universal newline mode (deprecated) |

### 写入取消空行
```python
# 取消空行
open('data.csv', 'w', newline='')
```

## warnings
### 忽略warning
```python
import warnings
warnings.filterwarnings("ignore")
```

### python时间处理（三）pandas.to_datetime
https://blog.csdn.net/DataCastle/article/details/84323603

### [python datetime unix时间戳以及字符串时间戳转换](https://www.cnblogs.com/williamjie/p/10256323.html)

```python 3
# 字典
# 取ket的值
dict.get(key, default=None)
dict['keys'] = 'values'

```

### 时间日期处理
```python

```
```python
import datetime
a = pd.to_datetime('31JAN2018:21:25:00', format='%d%b%Y:%H:%M:%S')
a
>> Timestamp('2018-01-31 21:25:00')

b = datetime.date(a.year,a.month,a.day)
# b = a.date()
b
>> datetime.date(2018, 1, 31)

b - datetime.date(2020,1,31)
>> datetime.timedelta(days=-730) 

# 以当前日期，加减1个月，生成以月份为增减量的日期序列
def dateList(start,n):  
    dateL = [] #声明一个空列表，存储目标序列
    for i in range(n):        
        date = pd.to_datetime(start)+ relativedelta(months=+i)    #当前日期往后推i个月
        date_str = date.strftime("%Y-%m-%d") #转化成字符型日期
        dateL.append(date_str) # 拼接
    return dateL         

dateL =dateList(start = '2020-01-02',n = 6)

# 提取年月
#  method 1
import pandas as pd
tmp['yearMonth'] =tmp.user_date.apply(lambda x: pd.to_datetime(x).strftime('%Y-%m'))

#  method 2
import time
def date_ym(date):   
	'''
	date :  传入日期格式的参数 
    第一步：先将日期格式转换成字符串
    第二步：截取前7位
    '''
    date_str = date.strftime('%Y-%m-%d')
    yearMonth = date_str[0:7]
    return yearMonth  

tmp['yearMonth'] = tmp['user_date'].apply(lambda x:date_ym(x)) # 应用

#  method 3
tmp['yearMonth'] = tmp['user_date'].apply(lambda x:str(x)[:7])
```

参考文献:
[python读取csv文件](https://www.cnblogs.com/liangshian/p/11272155.html)